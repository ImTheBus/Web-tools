<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>IMTHEBUS ‚Äì About & Info</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Shared site styles and core helpers -->
  <link rel="stylesheet" href="assets/imthebus-base.css" />
  <script src="assets/imthebus-core.js" defer></script>

  <!-- Fonts for this page / game -->
  <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&family=Inter:wght@400;600&family=Press+Start+2P&display=swap" rel="stylesheet" />

  <style>
    /* Layout and typography using shared sidebar/board shell */

    .about-sidebar-title {
      font-family: "Archivo Black", system-ui, sans-serif;
      font-size: 1.2rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      margin: 0 0 4px;
    }

    .about-sidebar-subtitle {
      font-size: 0.85rem;
      margin: 0 0 8px;
      color: #4b5563;
    }

    .about-heading {
      font-family: "Archivo Black", system-ui, sans-serif;
      font-size: 1.05rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin: 10px 0 4px;
    }

    .about-text {
      font-size: 0.9rem;
      line-height: 1.6;
      margin: 4px 0;
    }

    .about-list {
      margin: 4px 0 6px;
      padding-left: 1.1rem;
      font-size: 0.9rem;
    }

    .about-list li + li {
      margin-top: 2px;
    }

    .chip-label {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      border-radius: 999px;
      border: 1px solid #000;
      padding: 2px 8px;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      background: #facc15;
      margin-bottom: 4px;
    }

    .about-pill-link,
    .about-contact-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 5px 11px;
      border-radius: 999px;
      border: 2px solid #000;
      background: #ffffff;
      font-size: 0.85rem;
      margin-top: 6px;
      box-shadow: 4px 4px 0 #000;
      text-decoration: none;
      cursor: pointer;
    }

    .about-pill-link:hover,
    .about-contact-btn:hover {
      transform: translate(-2px, -2px);
      box-shadow: 6px 6px 0 #000;
    }

    .about-pill-link span.icon {
      font-size: 1.1rem;
    }

    .support-block {
      margin-top: 8px;
      padding: 8px 10px;
      border-radius: 10px;
      border: 2px solid #000;
      background: #faf5ff;
      box-shadow: 4px 4px 0 #000;
      font-size: 0.9rem;
    }

    .support-title {
      font-weight: 600;
      font-size: 0.88rem;
      margin-bottom: 3px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .support-cta {
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
      margin-top: 0.55rem;
      padding: 0.4rem 0.9rem;
      border-radius: 999px;
      font-size: 0.85rem;
      text-decoration: none;
      border: 2px solid #000;
      background: linear-gradient(135deg, #ffecd5, #ffe5f1);
      color: #000;
      box-shadow: 3px 3px 0 #000;
      cursor: pointer;
    }

    .support-cta:hover {
      transform: translate(-2px, -2px);
      box-shadow: 5px 5px 0 #000;
    }

    .about-footer-note {
      margin-top: 12px;
      font-size: 0.75rem;
      color: #4b5563;
    }

    /* Static post-it notes that do not affect the game */

    .static-notes-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    .static-note {
      position: relative;
      border-radius: 7px;
      border: 2px solid #000;
      padding: 6px 7px 7px;
      width: 120px;
      min-height: 70px;
      box-shadow:
        0 5px 10px rgba(0, 0, 0, 0.25),
        0 0 0 2px rgba(0, 0, 0, 0.5);
      font-family: "Permanent Marker", system-ui;
      font-size: 0.75rem;
      line-height: 1.2;
      text-align: center;
      cursor: pointer;
      background: #fff8a7;
      transform-origin: center top;
    }

    .static-note::before {
      content: "";
      position: absolute;
      top: 5px;
      left: 50%;
      transform: translateX(-50%);
      width: 26px;
      height: 8px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.85);
      box-shadow: 0 1px 0 rgba(0, 0, 0, 0.15);
    }

    .static-note-blue {
      background: #bde0fe;
    }

    .static-note-red {
      background: #ffb3c1;
    }

    .static-note-tilt-left {
      transform: rotate(-4deg);
    }

    .static-note-tilt-right {
      transform: rotate(3deg);
    }

    .static-note-flash {
      animation: edgeFlash 0.28s ease-out;
    }

    /* Retro mode overrides */

    body.retro-mode {
      background:
        radial-gradient(circle at 0 0, #3a0ca3, transparent 65%),
        radial-gradient(circle at 100% 0, #f72585, transparent 60%),
        radial-gradient(circle at 50% 100%, #4895ef, #000011);
      color: #f6f6ff;
    }

    body.retro-mode .sidebar-card,
    body.retro-mode .board-inner-shell {
      background: rgba(3, 4, 25, 0.96);
      border-color: #00f5d4;
      box-shadow:
        0 0 0 2px #000,
        0 0 18px rgba(0, 245, 212, 0.75);
    }

    body.retro-mode .support-block {
      background: rgba(0, 0, 0, 0.82);
      border-color: #00f5d4;
      box-shadow: 0 0 14px rgba(0, 245, 212, 0.7);
      color: #f9fafb;
    }

    body.retro-mode .support-cta {
      background: rgba(0, 0, 0, 0.7);
      color: #f6f6ff;
      border-color: #00f5d4;
      box-shadow:
        0 0 10px rgba(0, 245, 212, 0.75),
        0 0 0 2px #000;
    }

    /* Falling sticky-note game */

    .sticky-note {
      position: fixed;
      width: 82px;
      height: 78px;
      border-radius: 6px;
      box-shadow:
        0 6px 10px rgba(0, 0, 0, 0.35),
        0 0 0 2px rgba(0, 0, 0, 0.5);
      transform-origin: center top;
      cursor: pointer;
      z-index: 5;
      user-select: none;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 6px;
      font-family: "Permanent Marker", system-ui;
      font-size: 0.7rem;
      text-align: center;
      color: rgba(0, 0, 0, 0.85);
      transition: box-shadow 0.12s ease;
      background: #fff8a7;
    }

    .sticky-note::before {
      content: "";
      position: absolute;
      width: 28px;
      height: 11px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.15);
      top: -7px;
      left: 50%;
      transform: translateX(-50%);
    }

    .note-yellow { background: #fff8a7; }
    .note-red   { background: #ff8ba7; }
    .note-blue  { background: #bde0fe; }

    .note-tilt-left  { transform: rotate(-5deg); }
    .note-tilt-right { transform: rotate(4deg); }

    .note-edge-flash {
      animation: edgeFlash 0.26s ease-out;
    }

    @keyframes edgeFlash {
      0% {
        box-shadow:
          0 0 0 2px rgba(0, 0, 0, 0.5),
          0 0 0 4px rgba(0, 0, 0, 0);
      }
      50% {
        box-shadow:
          0 0 0 2px #000,
          0 0 0 6px #00f5d4;
      }
      100% {
        box-shadow:
          0 6px 10px rgba(0, 0, 0, 0.35),
          0 0 0 2px rgba(0, 0, 0, 0.5);
      }
    }

    body.retro-mode .sticky-note {
      box-shadow:
        0 0 12px rgba(0, 0, 0, 0.9),
        0 0 0 2px rgba(0, 245, 212, 0.7);
    }

    .note-fade-out {
      opacity: 0;
      transition: opacity 0.6s ease;
      pointer-events: none;
    }

    .note-bottom-hit {
      border-color: #ef4444;
      box-shadow:
        0 0 0 2px #ef4444,
        0 0 14px rgba(239, 68, 68, 0.85);
      animation: bottomHitFlash 0.8s ease-in-out infinite alternate;
    }

    @keyframes bottomHitFlash {
      0% {
        transform: translateY(0) scale(1);
        opacity: 1;
      }
      100% {
        transform: translateY(-4px) scale(1.03);
        opacity: 0.95;
      }
    }

    /* Retro scoreboard */

    .scoreboard {
      position: fixed;
      top: 0.75rem;
      right: 0.75rem;
      background: #05070a;
      border-radius: 0.7rem;
      border: 2px solid #00f5d4;
      padding: 0.5rem 0.8rem 0.45rem;
      font-family: "Press Start 2P", system-ui, monospace;
      font-size: 0.6rem;
      color: #00f5d4;
      letter-spacing: 0.16em;
      box-shadow: 0 0 12px rgba(0, 245, 212, 0.85);
      opacity: 0;
      transform: translateY(-8px);
      transition: opacity 0.15s ease, transform 0.15s ease;
      z-index: 20;
    }

    .scoreboard.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .score-line {
      display: flex;
      justify-content: space-between;
      gap: 0.75rem;
      margin-bottom: 0.2rem;
    }

    .score-label {
      opacity: 0.8;
    }

    .score-value {
      min-width: 4ch;
      text-align: right;
    }

    .score-small {
      font-size: 0.5rem;
      margin-top: 0.15rem;
      opacity: 0.75;
    }

    /* Game over overlay */

    .gameover-overlay {
      position: fixed;
      inset: 0;
      pointer-events: none;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      z-index: 30;
      overflow: hidden;
    }

    .gameover-inner {
      font-family: "Press Start 2P", system-ui, monospace;
      text-align: center;
      color: #f6f6ff;
      text-shadow:
        0 0 6px #000,
        0 0 18px #ff006e;
      padding: 1.4rem 1rem 2.4rem;
      opacity: 0;
      transform: translateY(120%);
    }

    .gameover-inner.visible {
      animation: gameoverRise 6s ease-out forwards;
    }

    @keyframes gameoverRise {
      0% {
        opacity: 0;
        transform: translateY(120%);
      }
      20% {
        opacity: 1;
        transform: translateY(0);
      }
      70% {
        opacity: 1;
        transform: translateY(-10%);
      }
      100% {
        opacity: 0;
        transform: translateY(-120%);
      }
    }

    .gameover-title {
      font-size: 1.4rem;
      margin-bottom: 0.8rem;
    }

    .gameover-score {
      font-size: 0.7rem;
      margin-bottom: 0.25rem;
    }

    .highscore-stamp {
      position: fixed;
      bottom: 0.7rem;
      right: 0.9rem;
      font-family: "Press Start 2P", system-ui, monospace;
      font-size: 0.55rem;
      color: #f6f6ff;
      padding: 0.4rem 0.6rem;
      border-radius: 0.5rem;
      border: 2px solid #00f5d4;
      background: rgba(0, 0, 0, 0.8);
      box-shadow: 0 0 10px rgba(0, 245, 212, 0.8);
      opacity: 0;
      transform: translateY(8px);
      transition: opacity 0.25s ease, transform 0.25s ease;
      z-index: 25;
      display: flex;
      align-items: center;
      gap: 0.45rem;
      pointer-events: auto;
    }

    .highscore-stamp.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .reset-btn {
      border: 1px solid #00f5d4;
      background: #05070a;
      color: #00f5d4;
      border-radius: 999px;
      padding: 2px 6px;
      font-size: 0.55rem;
      cursor: pointer;
    }

    .reset-btn:hover {
      background: #00f5d4;
      color: #05070a;
    }
  </style>
</head>

<body data-counter-key="about_page">
  <!-- Shared header -->
  <header data-include="partials/header.html"></header>

  <main class="page">
    <!-- LEFT: Ko-fi / Rougvie / contact -->
    <aside class="sidebar-card">
      <div class="about-sidebar-title">Support & contact</div>
      <p class="about-sidebar-subtitle">
        If these tools help your work, you can nudge future experiments along here.
      </p>

      <button
        class="about-contact-btn"
        type="button"
        onclick="window.location.href='mailto:contact@imthebus.co.uk?subject=IMTHEBUS%20feedback%20or%20chat';"
      >
        <span>‚úâÔ∏è</span>
        <span>Contact me with bugs, ideas, or general chit chat</span>
      </button>

      <div style="margin-top:10px;">
        <a
          class="about-pill-link"
          href="https://rougvie.com"
          target="_blank"
          rel="noopener noreferrer"
        >
          <span class="icon">üïπÔ∏è</span>
          <span>Visit <strong>Rougvie hub</strong> for other experiments</span>
        </a>
        <p class="about-text" style="font-size:0.86rem;margin-top:6px;">
          Rougvie.com hosts other side projects, prototypes, and odd little tools.
          IMTHEBUS is the part that leans hardest into management and decision making.
        </p>
      </div>

      <div class="support-block">
        <div class="support-title">Ko-fi tip jar</div>
        <p class="about-text" style="font-size:0.86rem;">
          A small one off Ko-fi helps justify time spent building and refining the toolbox.
          No subscriptions, no tiers, just a simple ‚Äúthis is useful‚Äù.
        </p>
        <a
          class="support-cta"
          href="https://ko-fi.com/"
          target="_blank"
          rel="noopener noreferrer"
        >
          <span>‚òï</span>
          <span>Support IMTHEBUS on Ko-fi</span>
        </a>
        <p class="about-text" style="font-size:0.8rem;margin-top:0.45rem;opacity:0.8;">
          Using the tools, sharing links, or sending feedback is also real support.
        </p>
      </div>

      <p class="about-footer-note">
        Somewhere behind this page, a few falling notes are trying not to hit the bottom.
        The static notes below are safe to click and do not affect the game.
      </p>

      <div class="static-notes-row">
        <div class="static-note static-note-tilt-left">
          Draft ideas live here.
        </div>
        <div class="static-note static-note-blue">
          ‚ÄúWe should park this.‚Äù
        </div>
        <div class="static-note static-note-red static-note-tilt-right">
          Check the real problem first.
        </div>
      </div>
    </aside>

    <!-- RIGHT: main About / Terms / Privacy content inside board shell -->
    <section class="board-wrapper">
      <div class="board-inner-shell">
        <section>
          <div class="chip-label">Why this exists</div>
          <h1 class="about-heading" style="margin-top:4px;">About IMTHEBUS</h1>
          <p class="about-text">
            IMTHEBUS is a small, evolving set of tools built for practical use in day to day work.
            The focus is on managers and teams who want clearer conversations and simpler decisions
            without another platform, login, or training course.
          </p>

          <h2 class="about-heading">Design principles</h2>
          <ul class="about-list">
            <li><strong>Lightweight</strong> open a link and it is ready. No accounts by default.</li>
            <li><strong>Focused</strong> each tool exists to solve one problem in one conversation.</li>
            <li><strong>Conversation first</strong> designed to sit in the middle of a group, not quietly solo.</li>
            <li><strong>Brutalist on purpose</strong> clear boxes, visible structure, and honest interface edges.</li>
          </ul>

          <p class="about-text">
            The whiteboard metaphor runs across the site. Different tools feel like sections of the same wall.
            Notes move between tools, prototypes can be rough, and nothing is treated as finished forever.
          </p>

          <h2 class="about-heading">Terms of use</h2>
          <p class="about-text">
            This is an experimental project. By using it you accept that:
          </p>
          <ul class="about-list">
            <li>You use all tools at your own risk and judgement.</li>
            <li>Nothing here replaces legal, HR, medical, or financial advice.</li>
            <li>You are responsible for any decisions taken using ideas from this site.</li>
            <li>The site may change, break, or vanish without notice.</li>
          </ul>

          <h2 class="about-heading">Privacy</h2>
          <p class="about-text">
            Current tools are built to run in your browser and avoid collecting personal data.
          </p>
          <ul class="about-list">
            <li>Where possible, inputs stay in your browser and are not stored on a server.</li>
            <li>Any analytics added later will focus on aggregated usage, not individuals.</li>
            <li>Future account or team features will ship with a clear privacy notice.</li>
            <li>Anything you type should still be treated like any other web form.</li>
          </ul>

          <p class="about-text">
            A more formal policy will be added as the project grows and linked from this page.
          </p>

          <h2 class="about-heading">Using the tools well</h2>
          <ul class="about-list">
            <li>Open a tool while you are in the conversation, not afterwards.</li>
            <li>Write in language everyone in the room would recognise.</li>
            <li>Treat everything on the board as draft, not a verdict.</li>
            <li>Move outcomes into your own systems once you are done.</li>
          </ul>

          <p class="about-text" style="margin-top:10px;">
            The rest of this page quietly hosts a small browser-based sticky note distraction.
            It still does not need instructions.
          </p>
        </section>
      </div>
    </section>
  </main>

  <!-- Shared footer -->
  <footer data-include="partials/footer.html"></footer>

  <!-- Retro scoreboard -->
  <div id="scoreboard" class="scoreboard" aria-live="polite">
    <div class="score-line">
      <span class="score-label">SCORE</span>
      <span id="score-value" class="score-value">0000</span>
    </div>
    <div class="score-line">
      <span class="score-label">HIGH</span>
      <span id="highscore-value" class="score-value">0000</span>
    </div>
    <div class="score-small">ImTheBus highscore: 7,556</div>
  </div>

  <!-- Game over overlay -->
  <div class="gameover-overlay" aria-hidden="true">
    <div id="gameover-inner" class="gameover-inner">
      <div class="gameover-title">GAME OVER</div>
      <div id="gameover-score" class="gameover-score"></div>
      <div id="gameover-high" class="gameover-score"></div>
      <div class="gameover-score">ImTheBus highscore: 7,556</div>
    </div>
  </div>

  <!-- High score stamp + reset -->
  <div id="highscore-stamp" class="highscore-stamp">
    <span id="highscore-stamp-text"></span>
    <button id="reset-button" class="reset-btn" type="button">Reset</button>
  </div>

  <script>
    (function () {
      const scoreboardEl = document.getElementById("scoreboard");
      const scoreValueEl = document.getElementById("score-value");
      const highValueEl = document.getElementById("highscore-value");
      const gameoverInner = document.getElementById("gameover-inner");
      const gameoverScoreEl = document.getElementById("gameover-score");
      const gameoverHighEl = document.getElementById("gameover-high");
      const highStampEl = document.getElementById("highscore-stamp");
      const highStampTextEl = document.getElementById("highscore-stamp-text");
      const resetButton = document.getElementById("reset-button");

      const NOTE_WIDTH = 82;
      const NOTE_HEIGHT = 78;

      const NOTE_LABELS = [
        "Another meeting",
        "Inbox zero (believed in)",
        "New initiative?",
        "Move this to next week",
        "Quick win‚Ñ¢",
        "Snack-based strategy",
        "Add to backlog?",
        "Scope creep alert",
        "Just one more tab",
        "Coffee first",
        "Ask what problem this solves",
        "Nice to have",
        "We should write a policy",
        "Future Dean problem",
        "Urgent!! (probably not)"
      ];

      const notes = [];
      let lastTime = null;
      let spawnTimer = null;
      let mouseX = window.innerWidth / 2;
      let mouseY = window.innerHeight / 2;

      const state = {
        score: 0,
        highScore: 0,
        retroMode: false,
        gameOver: false,
        baseSpeed: 55,
        spawnInterval: 2200
      };

      const storedHigh = parseInt(localStorage.getItem("itb_sticky_highscore") || "0", 10);
      if (!Number.isNaN(storedHigh)) {
        state.highScore = storedHigh;
      }

      function fmtScore(n) {
        return String(Math.max(0, Math.floor(n))).padStart(4, "0");
      }

      function updateScoreboard() {
        scoreValueEl.textContent = fmtScore(state.score);
        highValueEl.textContent = fmtScore(state.highScore);
      }

      updateScoreboard();

      function enterRetroMode() {
        if (state.retroMode) return;
        state.retroMode = true;
        state.baseSpeed = 95;
        state.spawnInterval = 1300;

        document.body.classList.add("retro-mode");
        scoreboardEl.classList.add("visible");

        if (spawnTimer) clearInterval(spawnTimer);
        spawnTimer = setInterval(spawnNote, state.spawnInterval);
      }

      function scheduleSpawn() {
        if (spawnTimer) clearInterval(spawnTimer);
        spawnTimer = setInterval(spawnNote, state.spawnInterval);
      }

      function randomType() {
        const r = Math.random();
        if (r < 0.6) return "yellow";
        if (r < 0.8) return "blue";
        return "red";
      }

      function randomLabel() {
        return NOTE_LABELS[Math.floor(Math.random() * NOTE_LABELS.length)];
      }

      function createNote() {
        const type = randomType();
        const el = document.createElement("div");
        el.classList.add("sticky-note");

        if (type === "yellow") el.classList.add("note-yellow");
        else if (type === "red") el.classList.add("note-red");
        else el.classList.add("note-blue");

        if (Math.random() < 0.5) el.classList.add("note-tilt-left");
        else el.classList.add("note-tilt-right");

        el.textContent = randomLabel();

        const startX = Math.random() * (window.innerWidth - NOTE_WIDTH);
        const startY = -NOTE_HEIGHT - Math.random() * 120;

        const speed = state.baseSpeed + Math.random() * 35;
        const horizontalDrift = (Math.random() - 0.5) * 20;
        const rotation = (Math.random() - 0.5) * 8;

        const note = {
          el,
          type,
          x: startX,
          y: startY,
          vy: speed,
          vx: horizontalDrift,
          rotation,
          hp: type === "red" ? 3 : 1
        };

        el.style.left = startX + "px";
        el.style.top = startY + "px";
        el.style.transform = `translate(0px, 0px) rotate(${rotation}deg)`;

        el.addEventListener("click", function (event) {
          event.stopPropagation();
          if (state.gameOver) return;

          enterRetroMode();

          el.classList.remove("note-edge-flash");
          void el.offsetWidth;
          el.classList.add("note-edge-flash");

          if (note.type === "red") {
            note.hp -= 1;
            if (note.hp <= 0) {
              state.score += 5;
              removeNote(note);
            }
          } else {
            state.score += 1;
            removeNote(note);
          }

          if (state.score > state.highScore) {
            state.highScore = state.score;
            localStorage.setItem("itb_sticky_highscore", String(state.highScore));
          }
          updateScoreboard();
        });

        document.body.appendChild(el);
        notes.push(note);
      }

      function removeNote(note) {
        const idx = notes.indexOf(note);
        if (idx !== -1) notes.splice(idx, 1);
        if (note.el && note.el.parentNode) {
          note.el.parentNode.removeChild(note.el);
        }
      }

      function spawnNote() {
        if (state.gameOver) return;
        createNote();
      }

      function handleBottomHit(note) {
        if (state.gameOver) return;
        state.gameOver = true;

        if (spawnTimer) {
          clearInterval(spawnTimer);
          spawnTimer = null;
        }

        // Freeze all notes in place
        notes.forEach((n) => {
          n.vy = 0;
          n.vx = 0;
        });

        // Highlight the one that hit the bottom
        if (note && note.el) {
          note.el.classList.add("note-bottom-hit");
        }

        if (state.score > state.highScore) {
          state.highScore = state.score;
          localStorage.setItem("itb_sticky_highscore", String(state.highScore));
          updateScoreboard();
        }

        // Brief pause so the bottom note is visible, then show GAME OVER
        setTimeout(() => {
          gameoverScoreEl.textContent = "Your high score: " + state.score.toLocaleString();
          gameoverHighEl.textContent = "Stored high score: " + state.highScore.toLocaleString();
          gameoverInner.classList.add("visible");
        }, 600);

        setTimeout(() => {
          highStampTextEl.textContent = "High score: " + state.highScore.toLocaleString();
          highStampEl.classList.add("visible");
        }, 5200);
      }

      function resetGame() {
        while (notes.length) {
          const n = notes.pop();
          if (n.el && n.el.parentNode) {
            n.el.parentNode.removeChild(n.el);
          }
        }

        state.score = 0;
        state.gameOver = false;
        state.retroMode = false;
        state.baseSpeed = 55;
        state.spawnInterval = 2200;

        updateScoreboard();

        document.body.classList.remove("retro-mode");
        scoreboardEl.classList.remove("visible");
        gameoverInner.classList.remove("visible");
        highStampEl.classList.remove("visible");

        lastTime = null;

        for (let i = 0; i < 4; i++) {
          setTimeout(spawnNote, 400 * i);
        }
        scheduleSpawn();
      }

      function loop(timestamp) {
        if (!lastTime) {
          lastTime = timestamp;
          requestAnimationFrame(loop);
          return;
        }
        const dt = (timestamp - lastTime) / 1000;
        lastTime = timestamp;

        if (!state.gameOver) {
          const height = window.innerHeight;

          for (let i = notes.length - 1; i >= 0; i--) {
            const note = notes[i];

            if (note.type === "blue") {
              const dx = note.x + NOTE_WIDTH / 2 - mouseX;
              const dy = note.y + NOTE_HEIGHT / 2 - mouseY;
              const distSq = dx * dx + dy * dy;
              const avoidRadius = 200 * 200;

              if (distSq < avoidRadius) {
                const factor = 120 / Math.sqrt(distSq + 1);
                note.vx += (dx / Math.sqrt(distSq + 1)) * factor;
              } else {
                note.vx *= 0.98;
              }
            }

            note.y += note.vy * dt;
            note.x += note.vx * dt;

            if (note.x < -30) note.x = -30;
            if (note.x > window.innerWidth - NOTE_WIDTH + 30) {
              note.x = window.innerWidth - NOTE_WIDTH + 30;
            }

            // Clamp at bottom edge
            if (note.y > height - NOTE_HEIGHT) {
              note.y = height - NOTE_HEIGHT;
              note.el.style.transform =
                `translate(${note.x}px, ${note.y}px) rotate(${note.rotation}deg)`;

              if (state.retroMode) {
                handleBottomHit(note);
              } else {
                removeNote(note);
              }
              continue;
            }

            note.el.style.transform =
              `translate(${note.x}px, ${note.y}px) rotate(${note.rotation}deg)`;
          }
        }

        requestAnimationFrame(loop);
      }

      document.addEventListener("mousemove", (event) => {
        mouseX = event.clientX;
        mouseY = event.clientY;
      });

      window.addEventListener("resize", () => {
        notes.forEach((note) => {
          if (note.x > window.innerWidth - NOTE_WIDTH) {
            note.x = window.innerWidth - NOTE_WIDTH;
          }
        });
      });

      resetButton.addEventListener("click", resetGame);

      document.addEventListener("keydown", (evt) => {
        if ((evt.key === "r" || evt.key === "R") && state.gameOver) {
          resetGame();
        }
      });

      // Click feedback for static notes (do not affect the game)
      document.querySelectorAll(".static-note").forEach((el) => {
        el.addEventListener("click", () => {
          el.classList.remove("static-note-flash");
          void el.offsetWidth;
          el.classList.add("static-note-flash");
        });
      });

      // Initial spawn
      for (let i = 0; i < 4; i++) {
        setTimeout(spawnNote, 400 * i);
      }
      scheduleSpawn();
      requestAnimationFrame(loop);
    })();
  </script>
</body>
</html>
